# Multi-AI Docker Architecture

## üèóÔ∏è –≠–ö–°–ü–ï–†–¢–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –î–õ–Ø MULTI-AI DOCKER –û–ë–†–ê–ó–û–í

### üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Specialized Images** - –ö–∞–∂–¥—ã–π AI –∏–º–µ–µ—Ç —Å–≤–æ–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑
2. **Smart Selection** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
3. **Unified Interface** - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö AI
4. **Graceful Fallbacks** - –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –º–∏–≥—Ä–∞—Ü–∏—è

### üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    ai-assistant.zsh                        ‚îÇ
‚îÇ                 (–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ             ‚îÇ             ‚îÇ
    ‚ñº             ‚ñº             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇgemini-cli‚îÇ  ‚îÇclaude-  ‚îÇ  ‚îÇfuture-ai-    ‚îÇ
‚îÇ:latest  ‚îÇ  ‚îÇcode-    ‚îÇ  ‚îÇtools:latest  ‚îÇ
‚îÇ         ‚îÇ  ‚îÇtools:   ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ         ‚îÇ  ‚îÇlatest   ‚îÇ  ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ             ‚îÇ             ‚îÇ
    ‚ñº             ‚ñº             ‚ñº
Gemini API    Claude API   Future APIs
```

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### 1. **Image Selector Pattern**

```bash
# –£–º–Ω—ã–π –≤—ã–±–æ—Ä –æ–±—Ä–∞–∑–∞
select_ai_image() {
    case "$ai_provider" in
        "gemini") echo "gemini-cli:latest" ;;
        "claude") echo "claude-code-tools:latest" ;;
        *) echo "Error: Unknown AI provider" ;;
    esac
}
```

#### 2. **Provider-specific Configuration**

```bash
# –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
setup_provider_env() {
    local provider="$1"
    case "$provider" in
        "gemini")
            echo "-e GOOGLE_CLOUD_PROJECT=gemini-cli-auth-478707"
            ;;
        "claude")
            echo "-e CLAUDE_API_KEY=$CLAUDE_API_KEY"
            ;;
    esac
}
```

#### 3. **Unified Execution Pattern**

```bash
run_ai_container() {
    local provider="$1"
    shift

    local image=$(select_ai_image "$provider")
    local env_vars=$(setup_provider_env "$provider")

    docker run --rm $env_vars "$image" "$provider" "$@"
}
```

### üöÄ Build Strategy

#### Multi-Stage Dockerfile

```dockerfile
# Base stage
FROM node:22-alpine AS base
# ... –æ–±—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ...

# Gemini stage
FROM base AS gemini
RUN npm install -g @google/gemini-cli
# ... Gemini —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...

# Claude stage
FROM base AS claude
RUN npm install -g @anthropic-ai/claude-cli
# ... Claude —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...

# Final stage - –≤—ã–±–æ—Ä –≤ runtime
FROM base
COPY --from=gemini /usr/local/lib/node_modules /usr/local/lib/node_modules/gemini
COPY --from=claude /usr/local/lib/node_modules /usr/local/lib/node_modules/claude
# ...
```

### üìã Deployment Pattern

#### Development

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã
gemini    # -> gemini-cli:latest
claude    # -> claude-code-tools:latest
```

#### Production

```bash
# –í–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å entrypoint
ai-exec gemini "command"
ai-exec claude "command"
```

### üîÑ Migration Path

1. **Phase 1**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ —Å –≤—ã–±–æ—Ä–æ–º –æ–±—Ä–∞–∑–∞ (‚úÖ DONE)
2. **Phase 2**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å smart image selector
3. **Phase 3**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã
4. **Phase 4**: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### üéÅ Benefits

1. **Performance**: –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ —Å–≤–æ–π AI
2. **Isolation**: –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–¥–Ω–∏–º AI –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
3. **Flexibility**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ AI
4. **Simplicity**: –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö

### ‚ö° Quick Test

```bash
# Test –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
source ai-assistant.zsh
gemini --version
claude --version

# –î–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã:
docker ps | grep -E "(gemini-cli|claude-code-tools)"
```
