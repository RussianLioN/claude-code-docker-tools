# План GitOps: Возврат к проверенным паттернам

Мы отказываемся от экспериментов и возвращаем архитектуру к состоянию "Known Good", адаптируя её для GLM.

## 1. Анализ "Golden Image" (Reference)

Мы берем за эталон логику из `old-scripts/gemini.zsh.backup`, где авторизация работала стабильно.

* **Паттерн:** Копирование credentials в `STATE_DIR` -> Монтирование `STATE_DIR` как домашней директории конфига (`/root/.gemini`).

## 2. Восстановление Gemini (Revert to Green)

1. Сверить блок `prepare_configuration` в `ai-assistant.zsh` с эталоном.
2. Исправить путь копирования `google_accounts.json`.
3. Убедиться, что монтируется директория, а не файл.

## 3. Реализация GLM по образу и подобию (Clone & Adapt)

1. **Подготовка:** Создать директорию `~/.docker-ai-config/global_state/glm_config`.
2. **Генерация:** Записать `settings.json` (и `config.json` для надежности) *в эту директорию* на хосте.
3. **Запуск:**
    * Монтировать: `-v .../glm_config:/root/.claude` (Mount Directory, not File).
    * Это точная копия работающего паттерна Gemini (`-v .../gemini_state:/root/.gemini`).

## 4. Верификация

1. `gemini`: Проверка авторизации (должна подхватить старый токен).
2. `glm`: Проверка старта (должна увидеть конфиг в папке).

Это решение минимизирует риски, так как использует уже отлаженные механизмы.
