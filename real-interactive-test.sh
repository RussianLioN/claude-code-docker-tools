#!/bin/bash

# –ù–∞—Å—Ç–æ—è—â–∏–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

set -e

echo "=== –ù–ê–°–¢–û–Ø–©–ò–ô –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –¢–ï–°–¢ ==="
echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
wait_for_user_input() {
    local prompt="$1"
    local var_name="$2"
    local default_value="${3:-}"
    
    echo "üî∏ $prompt"
    if [[ -n "$default_value" ]]; then
        echo "üî∏ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: $default_value"
    fi
    echo "üî∏ –í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ Enter:"
    echo -n "> "
    
    # –ß–∏—Ç–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    read user_input
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –≤–≤–µ–ª –∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if [[ -z "$user_input" && -n "$default_value" ]]; then
        user_input="$default_value"
    fi
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    printf -v "$var_name" '%s' "$user_input"
    echo "‚úÖ –í–≤–µ–¥–µ–Ω–æ: $user_input"
    echo ""
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
wait_for_confirmation() {
    local prompt="$1"
    local default="${2:-N}"
    
    echo "‚ùì $prompt"
    echo "üî∏ –í–≤–µ–¥–∏—Ç–µ 'y' –∏–ª–∏ 'Y' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: $default):"
    echo -n "> "
    
    # –ß–∏—Ç–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    read confirmation
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –≤–≤–µ–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if [[ -z "$confirmation" ]]; then
        confirmation="$default"
    fi
    
    if [[ "$confirmation" =~ ^[Yy]$ ]]; then
        echo "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ"
        echo ""
        return 0
    else
        echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
        echo ""
        return 1
    fi
}

# –¢–µ—Å—Ç 1: –í–≤–æ–¥ –∏–º–µ–Ω–∏
echo "üß™ –¢–ï–°–¢ 1: –í–≤–æ–¥ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
wait_for_user_input "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" user_name "–ê–Ω–æ–Ω–∏–º"

# –¢–µ—Å—Ç 2: –í–≤–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç–∞
echo "üß™ –¢–ï–°–¢ 2: –í–≤–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç–∞"
wait_for_user_input "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç" user_age

# –¢–µ—Å—Ç 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
echo "üß™ –¢–ï–°–¢ 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è"
if wait_for_confirmation "–í—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ?" "Y"; then
    echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
else
    echo "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å"
    exit 0
fi

# –¢–µ—Å—Ç 4: –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏
echo "üß™ –¢–ï–°–¢ 4: –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏"
wait_for_user_input "–í—ã–±–µ—Ä–∏—Ç–µ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (1-Claude, 2-Gemini, 3-GLM)" ai_choice "1"

case "$ai_choice" in
    "1")
        echo "ü§ñ –í—ã–±—Ä–∞–Ω Claude Code"
        ;;
    "2")
        echo "üíé –í—ã–±—Ä–∞–Ω Gemini"
        ;;
    "3")
        echo "üêâ –í—ã–±—Ä–∞–Ω GLM"
        ;;
    *)
        echo "‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤—ã–±–æ—Ä: $ai_choice"
        ;;
esac

# –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
echo "üß™ –¢–ï–°–¢ 5: –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"
if wait_for_confirmation "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ?"; then
    echo "üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
    echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
    echo "   –ò–º—è: $user_name"
    echo "   –í–æ–∑—Ä–∞—Å—Ç: $user_age"
    echo "   –í—ã–±–æ—Ä AI: $ai_choice"
else
    echo "üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
fi

echo ""
echo "=== –ö–û–ù–ï–¶ –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–ì–û –¢–ï–°–¢–ê ==="